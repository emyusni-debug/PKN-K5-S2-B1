<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buku Prestasi 6A</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #c0392b;
            --primary-light: #e74c3c;
            --primary-dark: #922b21;
            --primary-darker: #641e16;
            --secondary: #f5b041;
            --accent: #fadbd8;
            --accent-light: #fdedec;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray: #7f8c8d;
            --gray-dark: #5a6c7d;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --info: #3498db;
            --shadow: 0 4px 15px rgba(192, 57, 43, 0.2);
            --shadow-lg: 0 10px 40px rgba(192, 57, 43, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-darker) 0%, var(--primary) 50%, var(--primary-light) 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* LOGIN PAGE */
        .login-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--white);
        }

        .logo-wrapper {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
        }

        .logo-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
            background: var(--white);
            padding: 8px;
            box-shadow: var(--shadow-lg);
            animation: logoFloat 3s ease-in-out infinite, logoPulse 2s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7), var(--shadow-lg); }
            50% { box-shadow: 0 0 0 15px rgba(231, 76, 60, 0), var(--shadow-lg); }
        }

        .login-header h1 {
            font-size: 1.7rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .login-header h2 {
            font-size: 1rem;
            font-weight: 500;
            opacity: 0.95;
        }

        .login-header p {
            font-size: 0.85rem;
            opacity: 0.85;
            margin-top: 5px;
        }

        .login-card {
            background: var(--white);
            border-radius: 24px;
            padding: 35px 28px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
        }

        .login-card h3 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.15rem;
        }

        .login-option {
            background: var(--accent-light);
            border: 2px solid transparent;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-option:hover {
            border-color: var(--primary-light);
            transform: translateX(5px);
        }

        .login-option.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%);
        }

        .login-option h4 {
            color: var(--primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .login-option p {
            font-size: 0.75rem;
            color: var(--gray);
            margin-left: 28px;
        }

        .password-box {
            display: none;
            margin-top: 15px;
            animation: slideDown 0.3s ease;
        }

        .password-box.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 14px 50px 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(192, 57, 43, 0.1);
        }

        .input-group .toggle-eye {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--gray);
            font-size: 1.1rem;
        }

        .input-group .toggle-eye:hover {
            color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--dark);
        }

        .btn-danger {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            color: var(--white);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #1e8449 100%);
            color: var(--white);
        }

        /* DASHBOARD */
        .dashboard {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
            background: var(--gray-light);
        }

        .dashboard.active {
            display: block;
        }

        .dash-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .dash-header .logo-sm {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--white);
            padding: 5px;
            margin-bottom: 8px;
        }

        .dash-header h1 {
            font-size: 1.15rem;
            margin-bottom: 2px;
        }

        .dash-header p {
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .user-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.8rem;
        }

        /* TABS */
        .tabs-nav {
            display: flex;
            background: var(--white);
            padding: 8px;
            gap: 4px;
            position: sticky;
            top: 120px;
            z-index: 99;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 70px;
            padding: 10px 6px;
            border: none;
            background: var(--gray-light);
            border-radius: 10px;
            font-size: 0.68rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--gray-dark);
        }

        .tab-btn i {
            font-size: 1.1rem;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
            padding: 15px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CARDS */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }

        .card-title {
            color: var(--primary);
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* TARGET */
        .target-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .target-item {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 14px 8px;
            border-radius: 12px;
            text-align: center;
        }

        .target-item h4 {
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .target-item p {
            font-size: 0.65rem;
            opacity: 0.9;
        }

        /* FORM */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.85rem;
            color: var(--dark);
        }

        .form-group label i {
            color: var(--primary);
            margin-right: 6px;
        }

        .form-control {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(192, 57, 43, 0.1);
        }

        .ayat-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .ayat-range input {
            flex: 1;
        }

        .ayat-range span {
            color: var(--gray);
            font-weight: 500;
        }

        /* PREDIKAT */
        .predikat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .predikat-item {
            padding: 14px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .predikat-item:hover {
            border-color: var(--primary-light);
            background: var(--accent-light);
        }

        .predikat-item.selected {
            border-color: var(--primary);
            background: var(--accent);
        }

        .predikat-item i {
            font-size: 1.4rem;
            margin-bottom: 5px;
            display: block;
        }

        .predikat-item span {
            font-size: 0.78rem;
            font-weight: 500;
        }

        .predikat-item.istimewa i { color: #f1c40f; }
        .predikat-item.bagus i { color: #27ae60; }
        .predikat-item.cukup i { color: #3498db; }
        .predikat-item.mengulang i { color: #e74c3c; }

        /* VIEW NOTICE */
        .view-notice {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #f39c12;
            color: #856404;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.82rem;
        }

        .view-notice.hidden {
            display: none;
        }

        /* RECORDING */
        .record-box {
            text-align: center;
            padding: 25px 15px;
        }

        .record-btn {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .record-btn:hover {
            transform: scale(1.05);
        }

        .record-btn.recording {
            animation: recPulse 1s infinite;
        }

        @keyframes recPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            50% { box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); }
        }

        .rec-status {
            margin-top: 12px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .rec-timer {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary);
            margin-top: 8px;
        }

        .rec-preview {
            margin-top: 20px;
            display: none;
        }

        .rec-preview.show {
            display: block;
        }

        .rec-preview audio {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .rec-list {
            margin-top: 15px;
        }

        .rec-item {
            background: var(--gray-light);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rec-item .play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: var(--white);
            cursor: pointer;
            flex-shrink: 0;
        }

        .rec-item .info {
            flex: 1;
            min-width: 0;
        }

        .rec-item .info h4 {
            font-size: 0.82rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rec-item .info p {
            font-size: 0.68rem;
            color: var(--gray);
        }

        .rec-item .del-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1rem;
        }

        /* HISTORY */
        .history-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-head h3 {
            color: var(--primary);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .icon-btn.refresh {
            background: var(--info);
            color: var(--white);
        }

        .icon-btn.del-all {
            background: var(--primary);
            color: var(--white);
        }

        .icon-btn:hover {
            transform: scale(1.08);
        }

        .icon-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .history-item {
            background: var(--white);
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }

        .history-item .top-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .history-item .name {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.88rem;
        }

        .history-item .date {
            font-size: 0.68rem;
            color: var(--gray);
        }

        .history-item .detail {
            font-size: 0.78rem;
            color: var(--gray-dark);
            margin-bottom: 10px;
        }

        .history-item .bottom-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .badge-istimewa { background: #fef9e7; color: #d4ac0d; }
        .badge-bagus { background: #e8f8f5; color: #1e8449; }
        .badge-cukup { background: #ebf5fb; color: #2874a6; }
        .badge-mengulang { background: #fdedec; color: #c0392b; }

        .del-item-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* STATS */
        .stat-main {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            border-radius: 16px;
            padding: 22px;
            text-align: center;
            margin-bottom: 15px;
        }

        .stat-main h2 {
            font-size: 2.5rem;
            margin-bottom: 3px;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: var(--white);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stat-item i {
            font-size: 1.6rem;
            margin-bottom: 6px;
        }

        .stat-item h3 {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 2px;
        }

        .stat-item p {
            font-size: 0.72rem;
            color: var(--gray);
        }

        .progress-card {
            background: var(--white);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .progress-card h4 {
            color: var(--primary);
            margin-bottom: 18px;
            font-size: 0.9rem;
        }

        .progress-item {
            margin-bottom: 16px;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.78rem;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .fill-yasin { background: linear-gradient(90deg, #e74c3c, #f39c12); }
        .fill-waqiah { background: linear-gradient(90deg, #9b59b6, #e74c3c); }
        .fill-mulk { background: linear-gradient(90deg, #3498db, #1abc9c); }

        /* INFO */
        .info-box {
            background: var(--accent-light);
            border-radius: 14px;
            padding: 16px;
            margin-top: 15px;
        }

        .info-box h4 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 0.88rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 7px 0;
            border-bottom: 1px dashed #ddd;
            font-size: 0.78rem;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-row span:first-child {
            color: var(--gray);
        }

        .info-row span:last-child {
            font-weight: 500;
        }

        /* FOOTER */
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -3px 15px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .app-footer.hidden {
            display: none;
        }

        .footer-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .wa-btn {
            background: #25d366;
            color: var(--white);
        }

        .wa-btn:hover {
            background: #128c7e;
        }

        .logout-btn {
            background: var(--accent);
            color: var(--primary);
            padding: 10px 14px;
        }

        .logout-btn:hover {
            background: #f8c4c0;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-box {
            background: var(--white);
            border-radius: 20px;
            padding: 28px 24px;
            width: 100%;
            max-width: 360px;
            animation: modalPop 0.3s ease;
        }

        @keyframes modalPop {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-box h3 {
            text-align: center;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .modal-box p {
            text-align: center;
            color: var(--gray);
            margin-bottom: 20px;
            font-size: 0.88rem;
        }

        .modal-btns {
            display: flex;
            gap: 10px;
        }

        .modal-btns .btn {
            flex: 1;
        }

        /* TOAST */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 12px 24px;
            border-radius: 12px;
            color: var(--white);
            font-weight: 500;
            font-size: 0.9rem;
            z-index: 2000;
            transition: transform 0.4s ease;
            box-shadow: var(--shadow-lg);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success { background: var(--success); }
        .toast.error { background: var(--primary); }
        .toast.info { background: var(--info); }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 35px 15px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            opacity: 0.4;
            margin-bottom: 12px;
        }

        .empty-state p {
            font-size: 0.88rem;
        }

        /* LOADING */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--accent);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 380px) {
            .target-grid, .predikat-grid, .stat-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <!-- ===== LOGIN ===== -->
    <div class="login-page" id="loginPage">
        <div class="login-header">
            <div class="logo-wrapper">
                <img src="https://iili.io/fXljUa1.png" alt="Logo">
            </div>
            <h1>ðŸ“– Buku Prestasi 6A</h1>
            <h2>MIS HIDAYATUL MUBTADIIN</h2>
            <p><i class="fas fa-map-marker-alt"></i> Undaan Kidul Kudus</p>
        </div>

        <div class="login-card">
            <h3><i class="fas fa-sign-in-alt"></i> Silakan Masuk</h3>

            <div class="login-option" id="optGuru" onclick="selectOption('guru')">
                <h4><i class="fas fa-chalkboard-teacher"></i> Guru Tahfidh</h4>
                <p>Akses penuh untuk mengelola data</p>
            </div>

            <div class="password-box" id="pwdBox">
                <div class="input-group">
                    <input type="password" id="pwdInput" placeholder="Masukkan kata sandi">
                    <i class="fas fa-eye toggle-eye" id="toggleEye" onclick="togglePwd()"></i>
                </div>
            </div>

            <div class="login-option" id="optMurid" onclick="selectOption('murid')">
                <h4><i class="fas fa-user-graduate"></i> Murid</h4>
                <p>Hanya dapat melihat data</p>
            </div>

            <button class="btn btn-primary" onclick="doLogin()">
                <i class="fas fa-arrow-right"></i> Masuk
            </button>
        </div>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div class="dashboard" id="dashboard">
        <div class="dash-header">
            <img src="https://iili.io/fXljUa1.png" alt="Logo" class="logo-sm">
            <h1>ðŸ“– Buku Prestasi 6A</h1>
            <p>MIS Hidayatul Mubtadiin â€¢ Undaan Kidul Kudus</p>
            <div class="user-badge">
                <i class="fas fa-user"></i>
                <span id="userDisplay">Guru Tahfidh</span>
            </div>
        </div>

        <div class="tabs-nav">
            <button class="tab-btn active" onclick="switchTab('setor')">
                <i class="fas fa-book-quran"></i>
                <span>Setor</span>
            </button>
            <button class="tab-btn" onclick="switchTab('bimbingan')" id="tabBimbingan">
                <i class="fas fa-microphone"></i>
                <span>Bimbingan</span>
            </button>
            <button class="tab-btn" onclick="switchTab('riwayat')">
                <i class="fas fa-history"></i>
                <span>Riwayat</span>
            </button>
            <button class="tab-btn" onclick="switchTab('statistik')">
                <i class="fas fa-chart-bar"></i>
                <span>Statistik</span>
            </button>
        </div>

        <!-- TAB: SETOR -->
        <div class="tab-content active" id="contentSetor">
            <div class="view-notice hidden" id="viewNotice">
                <i class="fas fa-info-circle"></i>
                <span>Mode lihat saja - tidak dapat mengirim setoran</span>
            </div>

            <div class="card">
                <h3 class="card-title"><i class="fas fa-bullseye"></i> Target Hafalan</h3>
                <div class="target-grid">
                    <div class="target-item">
                        <h4>Yasin</h4>
                        <p>83 Ayat</p>
                    </div>
                    <div class="target-item">
                        <h4>Al-Waqi'ah</h4>
                        <p>96 Ayat</p>
                    </div>
                    <div class="target-item">
                        <h4>Al-Mulk</h4>
                        <p>30 Ayat</p>
                    </div>
                </div>
            </div>

            <div class="card" id="formCard">
                <h3 class="card-title"><i class="fas fa-pen-fancy"></i> Form Setoran</h3>

                <div class="form-group">
                    <label><i class="fas fa-user"></i> Pilih Siswa</label>
                    <select class="form-control" id="selSiswa">
                        <option value="">-- Pilih Siswa --</option>
                        <option value="1. Abdullah Fatir Ibrahim">1. Abdullah Fatir Ibrahim</option>
                        <option value="2. Arfaa Aizzatul Ramadhani">2. Arfaa Aizzatul Ramadhani</option>
                        <option value="3. Ayunda Qurrota A'Yun">3. Ayunda Qurrota A'Yun</option>
                        <option value="4. Azkiya Azzahwa">4. Azkiya Azzahwa</option>
                        <option value="5. Daffa Ibnu Hafidz">5. Daffa Ibnu Hafidz</option>
                        <option value="6. Fatihatul Husniya">6. Fatihatul Husniya</option>
                        <option value="7. Hania Syakira Assyafii">7. Hania Syakira Assyafii</option>
                        <option value="8. Ihda Alya Lathifa">8. Ihda Alya Lathifa</option>
                        <option value="9. Kanaya Afka Uliyani">9. Kanaya Afka Uliyani</option>
                        <option value="10. Lathif Akmal 'Azzam">10. Lathif Akmal 'Azzam</option>
                        <option value="11. Moh Adam Al Assegaf">11. Moh Adam Al Assegaf</option>
                        <option value="12. Moh Zaiyani Syarif">12. Moh Zaiyani Syarif</option>
                        <option value="13. Muh Althof Adabi">13. Muh Althof Adabi</option>
                        <option value="14. Muhammad Habibur Rohman">14. Muhammad Habibur Rohman</option>
                        <option value="15. Muhammad Khoirul Mannan">15. Muhammad Khoirul Mannan</option>
                        <option value="16. Raihan Izzuddin">16. Raihan Izzuddin</option>
                        <option value="17. Salwa Khuzama">17. Salwa Khuzama</option>
                        <option value="18. Savira Putri Mahira">18. Savira Putri Mahira</option>
                        <option value="19. Septian Norsa Amarta">19. Septian Norsa Amarta</option>
                        <option value="20. Zaida Ilmania Ramadhani">20. Zaida Ilmania Ramadhani</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-book-open"></i> Pilih Surat</label>
                    <select class="form-control" id="selSurat" onchange="updateMax()">
                        <option value="">-- Pilih Surat --</option>
                        <option value="36|Yasin|83">36. Yasin (83 Ayat)</option>
                        <option value="56|Al-Waqi'ah|96">56. Al-Waqi'ah (96 Ayat)</option>
                        <option value="67|Al-Mulk|30">67. Al-Mulk (30 Ayat)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-list-ol"></i> Rentang Ayat <small id="ayatHint"></small></label>
                    <div class="ayat-range">
                        <input type="number" class="form-control" id="ayatFrom" placeholder="Dari" min="1">
                        <span>â€”</span>
                        <input type="number" class="form-control" id="ayatTo" placeholder="Sampai" min="1">
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-star"></i> Predikat</label>
                    <div class="predikat-grid">
                        <div class="predikat-item istimewa" onclick="pickPredikat('Istimewa', this)">
                            <i class="fas fa-crown"></i>
                            <span>Istimewa</span>
                        </div>
                        <div class="predikat-item bagus" onclick="pickPredikat('Bagus', this)">
                            <i class="fas fa-thumbs-up"></i>
                            <span>Bagus</span>
                        </div>
                        <div class="predikat-item cukup" onclick="pickPredikat('Cukup', this)">
                            <i class="fas fa-check-circle"></i>
                            <span>Cukup</span>
                        </div>
                        <div class="predikat-item mengulang" onclick="pickPredikat('Mengulang', this)">
                            <i class="fas fa-redo-alt"></i>
                            <span>Mengulang</span>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="submitSetoran()" id="btnSubmit">
                    <i class="fas fa-paper-plane"></i> Kirim Setoran
                </button>
            </div>

            <div class="info-box">
                <h4><i class="fas fa-info-circle"></i> Informasi</h4>
                <div class="info-row">
                    <span>Kepala Madrasah</span>
                    <span>M. Arifin, S.Pd.I, M.Pd</span>
                </div>
                <div class="info-row">
                    <span>Guru Tahfidh</span>
                    <span>M. Yusni</span>
                </div>
            </div>
        </div>

        <!-- TAB: BIMBINGAN -->
        <div class="tab-content" id="contentBimbingan">
            <div class="card">
                <h3 class="card-title"><i class="fas fa-microphone-alt"></i> Rekam Bimbingan</h3>

                <div class="form-group">
                    <input type="text" class="form-control" id="recTitle" placeholder="Judul rekaman (cth: Bimbingan Yasin 1-10)">
                </div>

                <div class="record-box">
                    <button class="record-btn" id="recBtn" onclick="toggleRec()">
                        <i class="fas fa-microphone" id="recIcon"></i>
                    </button>
                    <p class="rec-status" id="recStatus">Tekan untuk merekam</p>
                    <p class="rec-timer" id="recTimer">00:00</p>
                </div>

                <div class="rec-preview" id="recPreview">
                    <audio id="audioPreview" controls></audio>
                    <button class="btn btn-success" onclick="saveRec()">
                        <i class="fas fa-save"></i> Simpan Rekaman
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><i class="fas fa-list"></i> Daftar Rekaman</h3>
                <div class="rec-list" id="recList">
                    <div class="empty-state">
                        <i class="fas fa-microphone-slash"></i>
                        <p>Belum ada rekaman</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: RIWAYAT -->
        <div class="tab-content" id="contentRiwayat">
            <div class="history-head">
                <h3><i class="fas fa-history"></i> Riwayat Setoran</h3>
                <div class="history-actions">
                    <button class="icon-btn refresh" onclick="refreshData()" id="btnRefresh" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="icon-btn del-all hidden" id="btnDelAll" onclick="showDelAllModal()" title="Hapus Semua">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>

            <div class="loading" id="loadingBox">
                <div class="spinner"></div>
                <p>Memuat data...</p>
            </div>

            <div id="historyContainer">
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>Belum ada riwayat setoran</p>
                </div>
            </div>
        </div>

        <!-- TAB: STATISTIK -->
        <div class="tab-content" id="contentStatistik">
            <div class="stat-main">
                <h2 id="totalSetor">0</h2>
                <p>Total Setoran</p>
            </div>

            <div class="stat-grid">
                <div class="stat-item">
                    <i class="fas fa-crown" style="color: #f1c40f;"></i>
                    <h3 id="cntIstimewa">0</h3>
                    <p>Istimewa</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-thumbs-up" style="color: #27ae60;"></i>
                    <h3 id="cntBagus">0</h3>
                    <p>Bagus</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-check-circle" style="color: #3498db;"></i>
                    <h3 id="cntCukup">0</h3>
                    <p>Cukup</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-redo-alt" style="color: #e74c3c;"></i>
                    <h3 id="cntMengulang">0</h3>
                    <p>Mengulang</p>
                </div>
            </div>

            <div class="progress-card">
                <h4><i class="fas fa-chart-line"></i> Progres Per Surat</h4>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Yasin (83 Ayat)</span>
                        <span id="pctYasin">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill fill-yasin" id="barYasin" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Al-Waqi'ah (96 Ayat)</span>
                        <span id="pctWaqiah">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill fill-waqiah" id="barWaqiah" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Al-Mulk (30 Ayat)</span>
                        <span id="pctMulk">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill fill-mulk" id="barMulk" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="app-footer hidden" id="appFooter">
        <a href="https://wa.me/6285176776403" target="_blank" class="footer-btn wa-btn">
            <i class="fab fa-whatsapp"></i> WhatsApp
        </a>
        <button class="footer-btn logout-btn" onclick="doLogout()">
            <i class="fas fa-sign-out-alt"></i>
        </button>
    </div>

    <!-- MODAL -->
    <div class="modal" id="modalDelAll">
        <div class="modal-box">
            <h3><i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i> Konfirmasi</h3>
            <p>Hapus semua data setoran?</p>
            <div class="modal-btns">
                <button class="btn btn-secondary" onclick="closeModal()">Batal</button>
                <button class="btn btn-danger" onclick="deleteAll()">Hapus</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // âš ï¸ GANTI URL INI DENGAN URL DEPLOYMENT ANDA
        // =============================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbxGzLC-yhVdIBrnhD5BvIZnQI9DzpWf672SP8vPQEGJDYO2OaHHgHLVBZ3mA_1Iuobp/exec';

        // =============================================
        // VARIABLES
        // =============================================
        let currentUser = null;
        let selectedPredikat = '';
        let historyData = [];
        let recordings = [];
        
        // Recording
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recInterval = null;
        let recSeconds = 0;

        // =============================================
        // INIT
        // =============================================
        document.addEventListener('DOMContentLoaded', () => {
            loadLocal();
            loadRecs();
        });

        // =============================================
        // LOGIN
        // =============================================
        function selectOption(type) {
            document.querySelectorAll('.login-option').forEach(el => el.classList.remove('active'));
            if (type === 'guru') {
                document.getElementById('optGuru').classList.add('active');
                document.getElementById('pwdBox').classList.add('show');
            } else {
                document.getElementById('optMurid').classList.add('active');
                document.getElementById('pwdBox').classList.remove('show');
            }
        }

        function togglePwd() {
            const input = document.getElementById('pwdInput');
            const icon = document.getElementById('toggleEye');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        function doLogin() {
            const isGuru = document.getElementById('optGuru').classList.contains('active');
            const isMurid = document.getElementById('optMurid').classList.contains('active');
            
            if (!isGuru && !isMurid) {
                showToast('Pilih jenis pengguna!', 'error');
                return;
            }

            if (isGuru) {
                if (document.getElementById('pwdInput').value !== 'emyusni') {
                    showToast('Kata sandi salah!', 'error');
                    return;
                }
                currentUser = 'guru';
                document.getElementById('userDisplay').textContent = 'Guru Tahfidh';
            } else {
                currentUser = 'murid';
                document.getElementById('userDisplay').textContent = 'Murid';
            }

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('appFooter').classList.remove('hidden');

            if (currentUser === 'murid') {
                document.getElementById('viewNotice').classList.remove('hidden');
                document.getElementById('formCard').style.opacity = '0.6';
                document.getElementById('formCard').style.pointerEvents = 'none';
                document.getElementById('tabBimbingan').classList.add('hidden');
                document.getElementById('btnDelAll').classList.add('hidden');
            } else {
                document.getElementById('viewNotice').classList.add('hidden');
                document.getElementById('formCard').style.opacity = '1';
                document.getElementById('formCard').style.pointerEvents = 'auto';
                document.getElementById('tabBimbingan').classList.remove('hidden');
                document.getElementById('btnDelAll').classList.remove('hidden');
            }

            refreshData();
            showToast('Selamat datang!', 'success');
        }

        function doLogout() {
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('appFooter').classList.add('hidden');
            document.getElementById('pwdInput').value = '';
            document.querySelectorAll('.login-option').forEach(el => el.classList.remove('active'));
            document.getElementById('pwdBox').classList.remove('show');
            switchTab('setor');
        }

        // =============================================
        // TABS
        // =============================================
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.closest('.tab-btn').classList.add('active');
            
            const map = {
                'setor': 'contentSetor',
                'bimbingan': 'contentBimbingan',
                'riwayat': 'contentRiwayat',
                'statistik': 'contentStatistik'
            };
            
            document.getElementById(map[tab]).classList.add('active');
            
            if (tab === 'riwayat') refreshData();
            if (tab === 'statistik') updateStats();
        }

        // =============================================
        // FORM
        // =============================================
        function updateMax() {
            const sel = document.getElementById('selSurat');
            const hint = document.getElementById('ayatHint');
            if (sel.value) {
                const max = sel.value.split('|')[2];
                hint.textContent = `(Maks: ${max})`;
                document.getElementById('ayatFrom').max = max;
                document.getElementById('ayatTo').max = max;
            } else {
                hint.textContent = '';
            }
        }

        function pickPredikat(val, el) {
            document.querySelectorAll('.predikat-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            selectedPredikat = val;
        }

        async function submitSetoran() {
            const siswa = document.getElementById('selSiswa').value;
            const surat = document.getElementById('selSurat').value;
            const from = document.getElementById('ayatFrom').value;
            const to = document.getElementById('ayatTo').value;

            if (!siswa || !surat || !from || !to || !selectedPredikat) {
                showToast('Lengkapi semua data!', 'error');
                return;
            }

            const parts = surat.split('|');
            const max = parseInt(parts[2]);

            if (parseInt(from) > parseInt(to)) {
                showToast('Ayat awal > akhir!', 'error');
                return;
            }

            if (parseInt(to) > max) {
                showToast(`Maks ayat: ${max}!`, 'error');
                return;
            }

            const btn = document.getElementById('btnSubmit');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';

            const params = new URLSearchParams({
                action: 'add',
                siswa: siswa,
                noSurat: parts[0],
                namaSurat: parts[1],
                ayatDari: from,
                ayatSampai: to,
                predikat: selectedPredikat
            });

            try {
                const res = await fetch(`${API_URL}?${params.toString()}`);
                const json = await res.json();
                
                if (json.success) {
                    showToast('Berhasil dikirim!', 'success');
                    
                    // Simpan juga ke lokal
                    historyData.push({
                        id: json.id || Date.now().toString(),
                        tanggal: new Date().toLocaleString('id-ID'),
                        siswa: siswa,
                        noSurat: parts[0],
                        namaSurat: parts[1],
                        ayatDari: from,
                        ayatSampai: to,
                        predikat: selectedPredikat
                    });
                    saveLocal();
                } else {
                    showToast('Gagal: ' + json.message, 'error');
                }
            } catch (err) {
                showToast('Error koneksi!', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Setoran';

            // Reset form
            document.getElementById('selSiswa').value = '';
            document.getElementById('selSurat').value = '';
            document.getElementById('ayatFrom').value = '';
            document.getElementById('ayatTo').value = '';
            document.getElementById('ayatHint').textContent = '';
            selectedPredikat = '';
            document.querySelectorAll('.predikat-item').forEach(i => i.classList.remove('selected'));

            updateStats();
        }

        // =============================================
        // HISTORY
        // =============================================
        async function refreshData() {
            const container = document.getElementById('historyContainer');
            const loading = document.getElementById('loadingBox');
            const btnRefresh = document.getElementById('btnRefresh');
            
            loading.classList.add('show');
            container.innerHTML = '';
            btnRefresh.disabled = true;

            try {
                const res = await fetch(`${API_URL}?action=get`);
                const json = await res.json();
                
                if (json.success) {
                    historyData = json.data || [];
                    saveLocal();
                }
            } catch (err) {
                console.log('Pakai data lokal');
            }

            loading.classList.remove('show');
            btnRefresh.disabled = false;
            renderHistory();
            updateStats();
            showToast('Data diperbarui', 'info');
        }

        function renderHistory() {
            const container = document.getElementById('historyContainer');

            if (historyData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>Belum ada riwayat</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = historyData.slice().reverse().map(item => `
                <div class="history-item">
                    <div class="top-row">
                        <div>
                            <div class="name">${item.siswa}</div>
                            <div class="date">${item.tanggal}</div>
                        </div>
                    </div>
                    <div class="detail">
                        <i class="fas fa-book-open"></i> ${item.noSurat}. ${item.namaSurat} | Ayat ${item.ayatDari} - ${item.ayatSampai}
                    </div>
                    <div class="bottom-row">
                        <span class="badge badge-${item.predikat.toLowerCase()}">${getIcon(item.predikat)} ${item.predikat}</span>
                        ${currentUser === 'guru' ? `
                            <button class="del-item-btn" onclick="deleteItem('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getIcon(p) {
            const icons = { 'Istimewa': 'ðŸ‘‘', 'Bagus': 'ðŸ‘', 'Cukup': 'âœ“', 'Mengulang': 'ðŸ”„' };
            return icons[p] || '';
        }

        async function deleteItem(id) {
            if (!confirm('Hapus data ini?')) return;

            try {
                await fetch(`${API_URL}?action=delete&id=${id}`);
            } catch (err) {}

            historyData = historyData.filter(i => i.id !== id);
            saveLocal();
            renderHistory();
            updateStats();
            showToast('Data dihapus', 'success');
        }

        function showDelAllModal() {
            document.getElementById('modalDelAll').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modalDelAll').classList.remove('show');
        }

        async function deleteAll() {
            try {
                await fetch(`${API_URL}?action=deleteAll`);
            } catch (err) {}

            historyData = [];
            saveLocal();
            renderHistory();
            updateStats();
            closeModal();
            showToast('Semua data dihapus', 'success');
        }

        // =============================================
        // STATS
        // =============================================
        function updateStats() {
            const total = historyData.length;
            document.getElementById('totalSetor').textContent = total;
            document.getElementById('cntIstimewa').textContent = historyData.filter(d => d.predikat === 'Istimewa').length;
            document.getElementById('cntBagus').textContent = historyData.filter(d => d.predikat === 'Bagus').length;
            document.getElementById('cntCukup').textContent = historyData.filter(d => d.predikat === 'Cukup').length;
            document.getElementById('cntMengulang').textContent = historyData.filter(d => d.predikat === 'Mengulang').length;

            const yasin = calcProgress('Yasin', 83);
            const waqiah = calcProgress("Al-Waqi'ah", 96);
            const mulk = calcProgress('Al-Mulk', 30);

            document.getElementById('barYasin').style.width = yasin + '%';
            document.getElementById('pctYasin').textContent = yasin + '%';
            document.getElementById('barWaqiah').style.width = waqiah + '%';
            document.getElementById('pctWaqiah').textContent = waqiah + '%';
            document.getElementById('barMulk').style.width = mulk + '%';
            document.getElementById('pctMulk').textContent = mulk + '%';
        }

        function calcProgress(surat, total) {
            const data = historyData.filter(d => d.namaSurat === surat && d.predikat !== 'Mengulang');
            let ayats = new Set();
            data.forEach(d => {
                for (let i = parseInt(d.ayatDari); i <= parseInt(d.ayatSampai); i++) {
                    ayats.add(i);
                }
            });
            return Math.min(100, Math.round((ayats.size / total) * 100));
        }

        // =============================================
        // RECORDING
        // =============================================
        async function toggleRec() {
            const btn = document.getElementById('recBtn');
            const icon = document.getElementById('recIcon');
            const status = document.getElementById('recStatus');

            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(audioChunks, { type: 'audio/wav' });
                        const url = URL.createObjectURL(blob);
                        document.getElementById('audioPreview').src = url;
                        document.getElementById('recPreview').classList.add('show');
                        stream.getTracks().forEach(t => t.stop());
                    };

                    mediaRecorder.start();
                    isRecording = true;
                    btn.classList.add('recording');
                    icon.classList.replace('fa-microphone', 'fa-stop');
                    status.textContent = 'Merekam...';
                    
                    recSeconds = 0;
                    recInterval = setInterval(() => {
                        recSeconds++;
                        const m = String(Math.floor(recSeconds / 60)).padStart(2, '0');
                        const s = String(recSeconds % 60).padStart(2, '0');
                        document.getElementById('recTimer').textContent = `${m}:${s}`;
                    }, 1000);
                } catch (err) {
                    showToast('Izinkan mikrofon!', 'error');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                clearInterval(recInterval);
                btn.classList.remove('recording');
                icon.classList.replace('fa-stop', 'fa-microphone');
                status.textContent = 'Selesai';
            }
        }

        function saveRec() {
            const title = document.getElementById('recTitle').value || `Rekaman ${new Date().toLocaleDateString('id-ID')}`;
            const url = document.getElementById('audioPreview').src;
            
            recordings.push({
                id: Date.now(),
                title: title,
                url: url,
                date: new Date().toLocaleDateString('id-ID'),
                duration: document.getElementById('recTimer').textContent
            });
            
            saveRecs();
            renderRecs();
            
            document.getElementById('recTitle').value = '';
            document.getElementById('recPreview').classList.remove('show');
            document.getElementById('recTimer').textContent = '00:00';
            document.getElementById('recStatus').textContent = 'Tekan untuk merekam';
            
            showToast('Rekaman disimpan!', 'success');
        }

        function renderRecs() {
            const list = document.getElementById('recList');
            if (recordings.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-microphone-slash"></i>
                        <p>Belum ada rekaman</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = recordings.slice().reverse().map(r => `
                <div class="rec-item">
                    <button class="play-btn" onclick="playRec('${r.url}')">
                        <i class="fas fa-play"></i>
                    </button>
                    <div class="info">
                        <h4>${r.title}</h4>
                        <p>${r.date} â€¢ ${r.duration}</p>
                    </div>
                    ${currentUser === 'guru' ? `
                        <button class="del-btn" onclick="delRec(${r.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        function playRec(url) {
            new Audio(url).play();
        }

        function delRec(id) {
            if (confirm('Hapus rekaman?')) {
                recordings = recordings.filter(r => r.id !== id);
                saveRecs();
                renderRecs();
                showToast('Rekaman dihapus', 'success');
            }
        }

        // =============================================
        // LOCAL STORAGE
        // =============================================
        function saveLocal() {
            localStorage.setItem('prestasi6a_data', JSON.stringify(historyData));
        }

        function loadLocal() {
            const d = localStorage.getItem('prestasi6a_data');
            if (d) historyData = JSON.parse(d);
        }

        function saveRecs() {
            localStorage.setItem('prestasi6a_recs', JSON.stringify(recordings));
        }

        function loadRecs() {
            const d = localStorage.getItem('prestasi6a_recs');
            if (d) recordings = JSON.parse(d);
        }

        // =============================================
        // TOAST
        // =============================================
        function showToast(msg, type = 'info') {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = `toast ${type} show`;
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>