<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Prestasi 6A</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #c0392b;
            --primary-light: #e74c3c;
            --white: #ffffff;
            --gray: #f5f5f5;
            --dark: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 15px;
            background: var(--gray);
        }

        /* LOGIN */
        .login {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #922b21, #c0392b, #e74c3c);
            padding: 20px;
        }

        .login img {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: #fff;
            padding: 6px;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .login h1 {
            color: #fff;
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .login p {
            color: rgba(255,255,255,0.85);
            font-size: 0.85rem;
            margin-bottom: 20px;
        }

        .login-box {
            background: #fff;
            border-radius: 18px;
            padding: 28px 24px;
            width: 100%;
            max-width: 340px;
        }

        .login-opt {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .login-opt button {
            flex: 1;
            padding: 18px 10px;
            border: 2px solid #eee;
            border-radius: 14px;
            background: #fff;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .login-opt button.active {
            border-color: var(--primary);
            background: #fef2f1;
            color: var(--primary);
        }

        .login-opt button i {
            display: block;
            font-size: 1.6rem;
            margin-bottom: 6px;
        }

        .pwd-box {
            display: none;
            margin-bottom: 15px;
        }

        .pwd-box.show {
            display: block;
        }

        .pwd-box .inp {
            position: relative;
        }

        .pwd-box input {
            width: 100%;
            padding: 16px 45px 16px 16px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1rem;
        }

        .pwd-box input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .pwd-box .eye {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #999;
            font-size: 1.1rem;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #fff;
        }

        .btn-primary:disabled {
            opacity: 0.7;
        }

        /* DASHBOARD */
        .dashboard {
            display: none;
            height: 100%;
            flex-direction: column;
        }

        .dashboard.active {
            display: flex;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #fff;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header img {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #fff;
            padding: 3px;
        }

        .header .info {
            flex: 1;
        }

        .header h1 {
            font-size: 1rem;
        }

        .header p {
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .header .user {
            font-size: 0.75rem;
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 15px;
        }

        /* TABS */
        .tabs {
            display: flex;
            background: #fff;
            border-bottom: 1px solid #eee;
        }

        .tabs button {
            flex: 1;
            padding: 12px 5px;
            border: none;
            background: none;
            font-size: 0.75rem;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tabs button i {
            display: block;
            font-size: 1.3rem;
            margin-bottom: 4px;
        }

        .tabs button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* CONTENT */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 14px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* FORM */
        .form-row {
            margin-bottom: 14px;
        }

        .form-row label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .form-row label i {
            color: var(--primary);
            margin-right: 6px;
        }

        .form-row select,
        .form-row input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            background: #fff;
        }

        .form-row select:focus,
        .form-row input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .ayat-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .ayat-row input {
            flex: 1;
        }

        .ayat-row span {
            color: #999;
            font-size: 1.2rem;
        }

        /* PREDIKAT */
        .predikat-row {
            display: flex;
            gap: 8px;
        }

        .pred-btn {
            flex: 1;
            padding: 14px 6px;
            border: 2px solid #eee;
            border-radius: 12px;
            background: #fff;
            cursor: pointer;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .pred-btn i {
            display: block;
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .pred-btn.selected {
            border-color: var(--primary);
            background: #fef2f1;
        }

        .pred-btn.p1 i { color: #f1c40f; }
        .pred-btn.p2 i { color: #27ae60; }
        .pred-btn.p3 i { color: #3498db; }
        .pred-btn.p4 i { color: #e74c3c; }

        /* NOTICE */
        .notice {
            background: #fff3cd;
            padding: 12px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #856404;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notice.hide {
            display: none;
        }

        /* HISTORY */
        .hist-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .hist-head h3 {
            font-size: 1rem;
            color: var(--primary);
        }

        .hist-btns {
            display: flex;
            gap: 8px;
        }

        .hist-btns button {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: #fff;
            font-size: 1rem;
        }

        .hist-btns .ref { background: #3498db; }
        .hist-btns .del { background: var(--primary); }

        .hist-item {
            background: #fff;
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
        }

        .hist-item .top {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .hist-item .name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--primary);
        }

        .hist-item .date {
            font-size: 0.75rem;
            color: #999;
        }

        .hist-item .detail {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 10px;
        }

        .hist-item .bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            font-size: 0.8rem;
            padding: 5px 14px;
            border-radius: 15px;
            font-weight: 600;
        }

        .badge.b1 { background: #fef9e7; color: #d4ac0d; }
        .badge.b2 { background: #e8f8f5; color: #1e8449; }
        .badge.b3 { background: #ebf5fb; color: #2874a6; }
        .badge.b4 { background: #fdedec; color: #c0392b; }

        .hist-item .del-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.1rem;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty p {
            font-size: 1rem;
        }

        /* STATS */
        .stat-main {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #fff;
            border-radius: 16px;
            padding: 22px;
            text-align: center;
            margin-bottom: 14px;
        }

        .stat-main h2 {
            font-size: 2.8rem;
        }

        .stat-main p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 14px;
        }

        .stat-item {
            background: #fff;
            border-radius: 14px;
            padding: 14px 6px;
            text-align: center;
        }

        .stat-item i {
            font-size: 1.5rem;
        }

        .stat-item h4 {
            font-size: 1.4rem;
            color: var(--primary);
            margin: 4px 0;
        }

        .stat-item span {
            font-size: 0.7rem;
            color: #999;
        }

        .prog-card {
            background: #fff;
            border-radius: 14px;
            padding: 16px;
        }

        .prog-card h4 {
            font-size: 0.95rem;
            color: var(--primary);
            margin-bottom: 14px;
        }

        .prog-item {
            margin-bottom: 14px;
        }

        .prog-item:last-child {
            margin-bottom: 0;
        }

        .prog-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .prog-bar {
            height: 12px;
            background: #eee;
            border-radius: 6px;
            overflow: hidden;
        }

        .prog-fill {
            height: 100%;
            border-radius: 6px;
        }

        .f1 { background: linear-gradient(90deg, #e74c3c, #f39c12); }
        .f2 { background: linear-gradient(90deg, #9b59b6, #e74c3c); }
        .f3 { background: linear-gradient(90deg, #3498db, #1abc9c); }

        /* BIMBINGAN */
        .rec-box {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .rec-box input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 12px;
            margin-bottom: 18px;
            font-size: 1rem;
        }

        .rec-btn {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
        }

        .rec-btn.recording {
            animation: recPulse 1s infinite;
        }

        @keyframes recPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(192,57,43,0.7); }
            50% { box-shadow: 0 0 0 18px rgba(192,57,43,0); }
        }

        .rec-status {
            margin-top: 12px;
            font-size: 0.95rem;
            color: #666;
        }

        .rec-timer {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary);
            margin-top: 5px;
        }

        .rec-preview {
            display: none;
            margin-top: 18px;
        }

        .rec-preview.show {
            display: block;
        }

        .rec-preview audio {
            width: 100%;
            margin-bottom: 14px;
        }

        .rec-list {
            margin-top: 18px;
        }

        .rec-item {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rec-item .play {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: #fff;
            cursor: pointer;
            font-size: 1rem;
        }

        .rec-item .info {
            flex: 1;
        }

        .rec-item .info h5 {
            font-size: 0.95rem;
            margin-bottom: 3px;
        }

        .rec-item .info span {
            font-size: 0.8rem;
            color: #999;
        }

        .rec-item .del {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.1rem;
        }

        /* FOOTER */
        .footer {
            background: #fff;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #eee;
        }

        .footer a {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: #25d366;
            color: #fff;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .footer .logout {
            padding: 12px 16px;
            border: none;
            background: #fef2f1;
            color: var(--primary);
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 999;
        }

        .modal.show {
            display: flex;
        }

        .modal-box {
            background: #fff;
            border-radius: 18px;
            padding: 28px 24px;
            width: 100%;
            max-width: 320px;
            text-align: center;
        }

        .modal-box h3 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.2rem;
        }

        .modal-box p {
            color: #666;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .modal-btns {
            display: flex;
            gap: 12px;
        }

        .modal-btns button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }

        .modal-btns .cancel {
            background: #eee;
            color: #333;
        }

        .modal-btns .confirm {
            background: var(--primary);
            color: #fff;
        }

        /* TOAST */
        .toast {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 14px 28px;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            z-index: 1000;
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success { background: #27ae60; }
        .toast.error { background: var(--primary); }
        .toast.info { background: #3498db; }

        .loading {
            text-align: center;
            padding: 30px;
            color: #999;
        }

        .spinner {
            width: 36px;
            height: 36px;
            border: 4px solid #eee;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hide { display: none !important; }
    </style>
</head>
<body>
    <div class="toast" id="toast"></div>

    <!-- LOGIN -->
    <div class="login" id="loginPage">
        <img src="https://iili.io/fXljUa1.png" alt="Logo">
        <h1>ðŸ“– Buku Prestasi 6A</h1>
        <p>MIS Hidayatul Mubtadiin - Undaan Kidul Kudus</p>

        <div class="login-box">
            <div class="login-opt">
                <button id="optG" onclick="pickOpt('guru')">
                    <i class="fas fa-chalkboard-teacher"></i>
                    Guru
                </button>
                <button id="optM" onclick="pickOpt('murid')">
                    <i class="fas fa-user-graduate"></i>
                    Murid
                </button>
            </div>

            <div class="pwd-box" id="pwdBox">
                <div class="inp">
                    <input type="password" id="pwd" placeholder="Kata sandi">
                    <i class="fas fa-eye eye" id="eye" onclick="toggleEye()"></i>
                </div>
            </div>

            <button class="btn btn-primary" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Masuk
            </button>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <img src="https://iili.io/fXljUa1.png" alt="Logo">
            <div class="info">
                <h1>ðŸ“– Buku Prestasi 6A</h1>
                <p>MIS Hidayatul Mubtadiin</p>
            </div>
            <span class="user" id="userBadge">Guru</span>
        </div>

        <div class="tabs">
            <button class="active" onclick="switchTab(0)"><i class="fas fa-book-quran"></i>Setor</button>
            <button id="tabRec" onclick="switchTab(1)"><i class="fas fa-microphone"></i>Rekam</button>
            <button onclick="switchTab(2)"><i class="fas fa-history"></i>Riwayat</button>
            <button onclick="switchTab(3)"><i class="fas fa-chart-pie"></i>Statistik</button>
        </div>

        <div class="content">
            <!-- TAB 0: SETOR -->
            <div class="tab-panel active" id="panel0">
                <div class="notice hide" id="notice">
                    <i class="fas fa-info-circle"></i> Mode lihat saja
                </div>

                <div id="formArea">
                    <div class="form-row">
                        <label><i class="fas fa-user"></i> Siswa</label>
                        <select id="selSiswa">
                            <option value="">-- Pilih Siswa --</option>
                            <option>1. Abdullah Fatir Ibrahim</option>
                            <option>2. Arfaa Aizzatul Ramadhani</option>
                            <option>3. Ayunda Qurrota A'Yun</option>
                            <option>4. Azkiya Azzahwa</option>
                            <option>5. Daffa Ibnu Hafidz</option>
                            <option>6. Fatihatul Husniya</option>
                            <option>7. Hania Syakira Assyafii</option>
                            <option>8. Ihda Alya Lathifa</option>
                            <option>9. Kanaya Afka Uliyani</option>
                            <option>10. Lathif Akmal 'Azzam</option>
                            <option>11. Moh Adam Al Assegaf</option>
                            <option>12. Moh Zaiyani Syarif</option>
                            <option>13. Muh Althof Adabi</option>
                            <option>14. Muhammad Habibur Rohman</option>
                            <option>15. Muhammad Khoirul Mannan</option>
                            <option>16. Raihan Izzuddin</option>
                            <option>17. Salwa Khuzama</option>
                            <option>18. Savira Putri Mahira</option>
                            <option>19. Septian Norsa Amarta</option>
                            <option>20. Zaida Ilmania Ramadhani</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <label><i class="fas fa-book"></i> Surat</label>
                        <select id="selSurat" onchange="updateMax()">
                            <option value="">-- Pilih Surat --</option>
                            <option value="36|Yasin|83">36. Yasin (83 Ayat)</option>
                            <option value="56|Al-Waqi'ah|96">56. Al-Waqi'ah (96 Ayat)</option>
                            <option value="67|Al-Mulk|30">67. Al-Mulk (30 Ayat)</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <label><i class="fas fa-list-ol"></i> Rentang Ayat <small id="maxAyat"></small></label>
                        <div class="ayat-row">
                            <input type="number" id="ayatA" placeholder="Dari" min="1">
                            <span>â€”</span>
                            <input type="number" id="ayatB" placeholder="Sampai" min="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <label><i class="fas fa-star"></i> Predikat</label>
                        <div class="predikat-row">
                            <button class="pred-btn p1" onclick="pickPred('Istimewa',this)">
                                <i class="fas fa-crown"></i>Istimewa
                            </button>
                            <button class="pred-btn p2" onclick="pickPred('Bagus',this)">
                                <i class="fas fa-thumbs-up"></i>Bagus
                            </button>
                            <button class="pred-btn p3" onclick="pickPred('Cukup',this)">
                                <i class="fas fa-check"></i>Cukup
                            </button>
                            <button class="pred-btn p4" onclick="pickPred('Mengulang',this)">
                                <i class="fas fa-redo"></i>Ulang
                            </button>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="btnKirim" onclick="kirim()">
                        <i class="fas fa-paper-plane"></i> Kirim Setoran
                    </button>
                </div>
            </div>

            <!-- TAB 1: REKAM -->
            <div class="tab-panel" id="panel1">
                <div class="rec-box">
                    <input type="text" id="recTitle" placeholder="Judul rekaman...">
                    <button class="rec-btn" id="recBtn" onclick="toggleRec()">
                        <i class="fas fa-microphone" id="recIcon"></i>
                    </button>
                    <p class="rec-status" id="recStatus">Tekan untuk merekam</p>
                    <p class="rec-timer" id="recTimer">00:00</p>

                    <div class="rec-preview" id="recPreview">
                        <audio id="audioPreview" controls></audio>
                        <button class="btn btn-primary" onclick="saveRec()">
                            <i class="fas fa-save"></i> Simpan Rekaman
                        </button>
                    </div>

                    <div class="rec-list" id="recList"></div>
                </div>
            </div>

            <!-- TAB 2: RIWAYAT -->
            <div class="tab-panel" id="panel2">
                <div class="hist-head">
                    <h3><i class="fas fa-history"></i> Riwayat Setoran</h3>
                    <div class="hist-btns">
                        <button class="ref" onclick="refresh()" id="btnRef"><i class="fas fa-sync-alt"></i></button>
                        <button class="del hide" id="btnDelAll" onclick="showModal()"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="loading hide" id="loading">
                    <div class="spinner"></div>
                    <p>Memuat data...</p>
                </div>
                <div id="histList"></div>
            </div>

            <!-- TAB 3: STATISTIK -->
            <div class="tab-panel" id="panel3">
                <div class="stat-main">
                    <h2 id="totalS">0</h2>
                    <p>Total Setoran</p>
                </div>

                <div class="stat-grid">
                    <div class="stat-item">
                        <i class="fas fa-crown" style="color:#f1c40f"></i>
                        <h4 id="sI">0</h4>
                        <span>Istimewa</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-thumbs-up" style="color:#27ae60"></i>
                        <h4 id="sB">0</h4>
                        <span>Bagus</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-check" style="color:#3498db"></i>
                        <h4 id="sC">0</h4>
                        <span>Cukup</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-redo" style="color:#e74c3c"></i>
                        <h4 id="sM">0</h4>
                        <span>Ulang</span>
                    </div>
                </div>

                <div class="prog-card">
                    <h4><i class="fas fa-chart-line"></i> Progres Per Surat</h4>
                    <div class="prog-item">
                        <div class="prog-label"><span>Yasin (83 Ayat)</span><span id="pY">0%</span></div>
                        <div class="prog-bar"><div class="prog-fill f1" id="bY" style="width:0%"></div></div>
                    </div>
                    <div class="prog-item">
                        <div class="prog-label"><span>Al-Waqi'ah (96 Ayat)</span><span id="pW">0%</span></div>
                        <div class="prog-bar"><div class="prog-fill f2" id="bW" style="width:0%"></div></div>
                    </div>
                    <div class="prog-item">
                        <div class="prog-label"><span>Al-Mulk (30 Ayat)</span><span id="pM">0%</span></div>
                        <div class="prog-bar"><div class="prog-fill f3" id="bM" style="width:0%"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <a href="https://wa.me/6285176776403" target="_blank">
                <i class="fab fa-whatsapp"></i> WhatsApp
            </a>
            <button class="logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal" id="modal">
        <div class="modal-box">
            <h3><i class="fas fa-exclamation-triangle" style="color:#e74c3c"></i> Konfirmasi</h3>
            <p>Hapus semua data setoran?</p>
            <div class="modal-btns">
                <button class="cancel" onclick="hideModal()">Batal</button>
                <button class="confirm" onclick="delAll()">Hapus</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG - GANTI DENGAN URL DEPLOYMENT ANDA
        const API = 'https://script.google.com/macros/s/AKfycbxGzLC-yhVdIBrnhD5BvIZnQI9DzpWf672SP8vPQEGJDYO2OaHHgHLVBZ3mA_1Iuobp/exec';

        let user = null;
        let pred = '';
        let data = [];
        let recs = [];
        let mediaRec = null;
        let chunks = [];
        let isRec = false;
        let recInt = null;
        let recSec = 0;

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            data = JSON.parse(localStorage.getItem('d6a') || '[]');
            recs = JSON.parse(localStorage.getItem('r6a') || '[]');
        });

        // LOGIN
        function pickOpt(t) {
            document.getElementById('optG').classList.toggle('active', t === 'guru');
            document.getElementById('optM').classList.toggle('active', t === 'murid');
            document.getElementById('pwdBox').classList.toggle('show', t === 'guru');
        }

        function toggleEye() {
            const p = document.getElementById('pwd');
            const e = document.getElementById('eye');
            if (p.type === 'password') {
                p.type = 'text';
                e.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                p.type = 'password';
                e.classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        function login() {
            const isG = document.getElementById('optG').classList.contains('active');
            const isM = document.getElementById('optM').classList.contains('active');

            if (!isG && !isM) return toast('Pilih jenis user!', 'error');

            if (isG) {
                if (document.getElementById('pwd').value !== 'emyusni') return toast('Password salah!', 'error');
                user = 'guru';
                document.getElementById('userBadge').textContent = 'Guru';
            } else {
                user = 'murid';
                document.getElementById('userBadge').textContent = 'Murid';
            }

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');

            if (user === 'murid') {
                document.getElementById('notice').classList.remove('hide');
                document.getElementById('formArea').style.opacity = '0.5';
                document.getElementById('formArea').style.pointerEvents = 'none';
                document.getElementById('tabRec').classList.add('hide');
                document.getElementById('btnDelAll').classList.add('hide');
            } else {
                document.getElementById('notice').classList.add('hide');
                document.getElementById('formArea').style.opacity = '1';
                document.getElementById('formArea').style.pointerEvents = 'auto';
                document.getElementById('tabRec').classList.remove('hide');
                document.getElementById('btnDelAll').classList.remove('hide');
            }

            refresh();
            toast('Selamat datang!', 'success');
        }

        function logout() {
            user = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('pwd').value = '';
            document.querySelectorAll('.login-opt button').forEach(b => b.classList.remove('active'));
            document.getElementById('pwdBox').classList.remove('show');
            switchTab(0);
        }

        // TABS
        function switchTab(i) {
            document.querySelectorAll('.tabs button').forEach((b, idx) => b.classList.toggle('active', idx === i));
            document.querySelectorAll('.tab-panel').forEach((p, idx) => p.classList.toggle('active', idx === i));
            if (i === 2) refresh();
            if (i === 3) updateStats();
        }

        // FORM
        function updateMax() {
            const v = document.getElementById('selSurat').value;
            const h = document.getElementById('maxAyat');
            if (v) {
                const m = v.split('|')[2];
                h.textContent = `(maks ${m})`;
                document.getElementById('ayatA').max = m;
                document.getElementById('ayatB').max = m;
            } else {
                h.textContent = '';
            }
        }

        function pickPred(v, el) {
            document.querySelectorAll('.pred-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            pred = v;
        }

        async function kirim() {
            const siswa = document.getElementById('selSiswa').value;
            const surat = document.getElementById('selSurat').value;
            const a = document.getElementById('ayatA').value;
            const b = document.getElementById('ayatB').value;

            if (!siswa || !surat || !a || !b || !pred) return toast('Lengkapi semua data!', 'error');

            const p = surat.split('|');
            if (+a > +b) return toast('Ayat awal > akhir!', 'error');
            if (+b > +p[2]) return toast('Melebihi jumlah ayat!', 'error');

            const btn = document.getElementById('btnKirim');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';

            const params = new URLSearchParams({
                action: 'add',
                siswa, noSurat: p[0], namaSurat: p[1], ayatDari: a, ayatSampai: b, predikat: pred
            });

            try {
                const res = await fetch(`${API}?${params}`);
                const json = await res.json();
                if (json.success) {
                    toast('Berhasil terkirim!', 'success');
                    data.push({
                        id: json.id || Date.now().toString(),
                        tanggal: new Date().toLocaleString('id-ID'),
                        siswa, noSurat: p[0], namaSurat: p[1], ayatDari: a, ayatSampai: b, predikat: pred
                    });
                    localStorage.setItem('d6a', JSON.stringify(data));
                }
            } catch (e) {
                toast('Error koneksi!', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Setoran';

            // Reset HANYA siswa, ayat, predikat - SURAT TETAP
            document.getElementById('selSiswa').value = '';
            document.getElementById('ayatA').value = '';
            document.getElementById('ayatB').value = '';
            pred = '';
            document.querySelectorAll('.pred-btn').forEach(b => b.classList.remove('selected'));

            updateStats();
        }

        // HISTORY
        async function refresh() {
            const list = document.getElementById('histList');
            const load = document.getElementById('loading');
            load.classList.remove('hide');
            list.innerHTML = '';

            try {
                const res = await fetch(`${API}?action=get`);
                const json = await res.json();
                if (json.success) {
                    data = json.data || [];
                    localStorage.setItem('d6a', JSON.stringify(data));
                }
            } catch (e) {}

            load.classList.add('hide');
            renderHist();
            updateStats();
        }

        function renderHist() {
            const list = document.getElementById('histList');
            if (!data.length) {
                list.innerHTML = '<div class="empty"><i class="fas fa-inbox"></i><p>Belum ada data</p></div>';
                return;
            }

            const icons = { Istimewa: 'ðŸ‘‘', Bagus: 'ðŸ‘', Cukup: 'âœ“', Mengulang: 'ðŸ”„' };
            const badges = { Istimewa: 'b1', Bagus: 'b2', Cukup: 'b3', Mengulang: 'b4' };

            list.innerHTML = data.slice().reverse().map(d => `
                <div class="hist-item">
                    <div class="top">
                        <span class="name">${d.siswa}</span>
                        <span class="date">${d.tanggal}</span>
                    </div>
                    <div class="detail"><i class="fas fa-book"></i> ${d.noSurat}. ${d.namaSurat} | Ayat ${d.ayatDari}-${d.ayatSampai}</div>
                    <div class="bottom">
                        <span class="badge ${badges[d.predikat]}">${icons[d.predikat]} ${d.predikat}</span>
                        ${user === 'guru' ? `<button class="del-btn" onclick="delItem('${d.id}')"><i class="fas fa-trash"></i></button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function delItem(id) {
            if (!confirm('Hapus data ini?')) return;
            try { await fetch(`${API}?action=delete&id=${id}`); } catch (e) {}
            data = data.filter(d => d.id !== id);
            localStorage.setItem('d6a', JSON.stringify(data));
            renderHist();
            updateStats();
            toast('Data dihapus', 'success');
        }

        function showModal() { document.getElementById('modal').classList.add('show'); }
        function hideModal() { document.getElementById('modal').classList.remove('show'); }

        async function delAll() {
            try { await fetch(`${API}?action=deleteAll`); } catch (e) {}
            data = [];
            localStorage.setItem('d6a', JSON.stringify(data));
            renderHist();
            updateStats();
            hideModal();
            toast('Semua data dihapus', 'success');
        }

        // STATS
        function updateStats() {
            document.getElementById('totalS').textContent = data.length;
            document.getElementById('sI').textContent = data.filter(d => d.predikat === 'Istimewa').length;
            document.getElementById('sB').textContent = data.filter(d => d.predikat === 'Bagus').length;
            document.getElementById('sC').textContent = data.filter(d => d.predikat === 'Cukup').length;
            document.getElementById('sM').textContent = data.filter(d => d.predikat === 'Mengulang').length;

            const calc = (s, t) => {
                const arr = data.filter(d => d.namaSurat === s && d.predikat !== 'Mengulang');
                let set = new Set();
                arr.forEach(d => { for (let i = +d.ayatDari; i <= +d.ayatSampai; i++) set.add(i); });
                return Math.min(100, Math.round((set.size / t) * 100));
            };

            const y = calc('Yasin', 83), w = calc("Al-Waqi'ah", 96), m = calc('Al-Mulk', 30);
            document.getElementById('bY').style.width = y + '%';
            document.getElementById('pY').textContent = y + '%';
            document.getElementById('bW').style.width = w + '%';
            document.getElementById('pW').textContent = w + '%';
            document.getElementById('bM').style.width = m + '%';
            document.getElementById('pM').textContent = m + '%';
        }

        // RECORDING
        async function toggleRec() {
            const btn = document.getElementById('recBtn');
            const icon = document.getElementById('recIcon');
            const status = document.getElementById('recStatus');

            if (!isRec) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRec = new MediaRecorder(stream);
                    chunks = [];
                    mediaRec.ondataavailable = e => chunks.push(e.data);
                    mediaRec.onstop = () => {
                        const blob = new Blob(chunks, { type: 'audio/wav' });
                        document.getElementById('audioPreview').src = URL.createObjectURL(blob);
                        document.getElementById('recPreview').classList.add('show');
                        stream.getTracks().forEach(t => t.stop());
                    };
                    mediaRec.start();
                    isRec = true;
                    btn.classList.add('recording');
                    icon.classList.replace('fa-microphone', 'fa-stop');
                    status.textContent = 'Merekam...';
                    recSec = 0;
                    recInt = setInterval(() => {
                        recSec++;
                        document.getElementById('recTimer').textContent = 
                            String(Math.floor(recSec/60)).padStart(2,'0') + ':' + String(recSec%60).padStart(2,'0');
                    }, 1000);
                } catch (e) {
                    toast('Izinkan akses mikrofon!', 'error');
                }
            } else {
                mediaRec.stop();
                isRec = false;
                clearInterval(recInt);
                btn.classList.remove('recording');
                icon.classList.replace('fa-stop', 'fa-microphone');
                status.textContent = 'Rekaman selesai';
            }
        }

        function saveRec() {
            const title = document.getElementById('recTitle').value || 'Rekaman ' + new Date().toLocaleDateString('id-ID');
            recs.push({
                id: Date.now(),
                title,
                url: document.getElementById('audioPreview').src,
                date: new Date().toLocaleDateString('id-ID'),
                dur: document.getElementById('recTimer').textContent
            });
            localStorage.setItem('r6a', JSON.stringify(recs));
            renderRecs();
            document.getElementById('recTitle').value = '';
            document.getElementById('recPreview').classList.remove('show');
            document.getElementById('recTimer').textContent = '00:00';
            document.getElementById('recStatus').textContent = 'Tekan untuk merekam';
            toast('Rekaman disimpan!', 'success');
        }

        function renderRecs() {
            const list = document.getElementById('recList');
            if (!recs.length) {
                list.innerHTML = '<div class="empty"><i class="fas fa-microphone-slash"></i><p>Belum ada rekaman</p></div>';
                return;
            }
            list.innerHTML = recs.slice().reverse().map(r => `
                <div class="rec-item">
                    <button class="play" onclick="new Audio('${r.url}').play()"><i class="fas fa-play"></i></button>
                    <div class="info"><h5>${r.title}</h5><span>${r.date} â€¢ ${r.dur}</span></div>
                    ${user === 'guru' ? `<button class="del" onclick="delRec(${r.id})"><i class="fas fa-trash"></i></button>` : ''}
                </div>
            `).join('');
        }

        function delRec(id) {
            if (!confirm('Hapus rekaman ini?')) return;
            recs = recs.filter(r => r.id !== id);
            localStorage.setItem('r6a', JSON.stringify(recs));
            renderRecs();
            toast('Rekaman dihapus', 'success');
        }

        // TOAST
        function toast(msg, type = 'info') {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = `toast ${type} show`;
            setTimeout(() => t.classList.remove('show'), 2500);
        }
    </script>
</body>
</html>